<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <title>Управление на сгради - Анализ на апартаменти</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="/static/css/app.css" rel="stylesheet" />
    <!-- Sidebar Styles -->
    <th:block th:replace="~{fragments/sidebar :: sidebarStyles}"></th:block>
</head>
<body>
    <!-- Sidebar Toggle Button (Mobile) -->
    <th:block th:replace="~{fragments/sidebar :: sidebarToggle}"></th:block>
    
    <!-- Sidebar -->
    <th:block th:replace="~{fragments/sidebar :: sidebar}"></th:block>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
    <div class="container-fluid py-4">
        <!-- Статистика за сгради -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-left-primary shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="card-title text-primary mb-1">
                                    <i class="bi bi-buildings me-2"></i>Общ брой сгради
                                </h5>
                                <h2 class="mb-0 text-primary" th:text="${buildingsCount != null ? buildingsCount : 0}">0</h2>
                                <p class="text-muted mb-0 mt-2">
                                    <small>Общ брой регистрирани сгради в системата</small>
                                </p>
                            </div>
                            <div class="text-end">
                                <div class="display-4 text-primary opacity-50">
                                    <i class="bi bi-building"></i>
                                </div>
                                <div class="mt-2">
                                    <a th:href="@{/buildings/add}" class="btn btn-success">
                                        <i class="bi bi-plus-circle me-2"></i>Добави сграда
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<!-- Информация за текущата сграда -->
<div class="row mb-4">
 <div class="col-12">
 <div class="card border-left-primary">
 <div class="card-body">
 <div class="d-flex justify-content-between align-items-center">
 <div>
 <h5 class="card-title text-primary">
 <i class="bi bi-building me-2"></i>Текуща сграда
 </h5>
 <h4 class="mb-1"></h4>
 <p class="text-muted mb-0"></p>
 <small class="text-muted">Създадена: <span></span></small>
 </div>
 <div class="text-end">
 <span class="badge bg-success fs-6"></span>
 <div class="mt-2">
 <a href="/" class="btn btn-primary">
 <i class="bi bi-arrow-right me-2"></i>Към апартаментите
 </a>
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>
</div>
<div class="row mb-4">
 <div class="col-12">
 <div class="alert alert-info">
 <i class="bi bi-info-circle me-2"></i>
 <strong>Информация:</strong> Няма избрана активна сграда. Моля, изберете сграда от списъка по-долу или добавете нова сграда.
 </div>
 </div>
</div>

<!-- Списък с всички сгради -->
<div class="row mb-4">
 <div class="col-12">
 <div class="card">
 <div class="card-header d-flex justify-content-between align-items-center">
 <h6 class="m-0 font-weight-bold text-primary">
 <i class="bi bi-buildings me-2"></i>Всички сгради 
 <span class="badge bg-primary ms-2" th:text="'(' + ${buildingsCount != null ? buildingsCount : 0} + ')'">(0)</span>
 </h6>
 <a th:href="@{/buildings/add}" class="btn btn-success btn-sm">
 <i class="bi bi-plus-circle me-2"></i>Добави сграда
 </a>
 </div>
 <div class="card-body">
 <div class="table-responsive">
 <table class="table table-bordered table-hover" id="buildingsTable">
 <thead class="table-light">
 <tr>
 <th>Име на сграда</th>
 <th>Адрес</th>
 <th>Дата на създаване</th>
 <th>Статус / Етап</th>
 <th>Действия</th>
 </tr>
 </thead>
 <tbody>
 <tr th:each="building : ${buildings}" th:if="${buildings != null and !buildings.isEmpty()}">
 <td>
 <strong th:text="${building.name}">Име на сграда</strong>
 <span class="badge bg-primary ms-2" th:if="${building.status == 'активна'}">Активна</span>
 <span class="badge bg-warning ms-2" th:if="${building.status == 'в разработка'}">В разработка</span>
 <span class="badge bg-success ms-2" th:if="${building.status == 'завършена'}">Завършена</span>
 <span class="badge bg-secondary ms-2" th:if="${building.status == 'на пауза'}">На пауза</span>
 </td>
 <td th:text="${building.address != null ? building.address : '-'}">Адрес</td>
 <td th:text="${building.createdAt != null ? #temporals.format(building.createdAt, 'dd.MM.yyyy HH:mm') : '-'}">Дата</td>
 <td>
 <span class="badge" 
       th:classappend="${building.status == 'активна'} ? 'bg-success' : 
                       (${building.status == 'в разработка'} ? 'bg-warning' : 
                       (${building.status == 'завършена'} ? 'bg-info' : 'bg-secondary'))"
       th:text="${building.status != null ? building.status : 'неизвестен'}">
 Статус
 </span>
 <div th:if="${building.stage != null and !building.stage.isEmpty()}" class="small text-muted mt-1" th:text="'Етап: ' + ${building.stage}"></div>
 </td>
 <td>
 <div class="btn-group" role="group">
 <a th:href="@{/buildings/{id}(id=${building.id})}" 
    class="btn btn-sm btn-primary" title="Преглед с всички детайли">
 <i class="bi bi-eye me-1"></i>Преглед
 </a>
 <a th:href="@{/buildings/edit/{id}(id=${building.id})}"
    class="btn btn-sm btn-outline-warning" title="Редактирай">
 <i class="bi bi-pencil"></i>
 </a>
 <form th:action="@{/buildings/delete}" method="POST" class="d-inline">
 <input type="hidden" name="buildingId" th:value="${building.id}" />
 <button type="submit" class="btn btn-sm btn-outline-danger"
 title="Изтрий"
 onclick="return confirm('Сигурни ли сте, че искате да изтриете сградата?')">
 <i class="bi bi-trash"></i>
 </button>
 </form>
 </div>
 </td>
 </tr>
 <tr th:if="${buildings == null or buildings.isEmpty()}">
 <td colspan="5" class="text-center py-4">
 <i class="bi bi-buildings text-muted" style="font-size: 3rem;"></i>
 <h5 class="text-muted mt-3">Няма сгради</h5>
 <p class="text-muted">Добавете първата сграда за да започнете работа.</p>
 <a th:href="@{/buildings/add}" class="btn btn-primary">
 <i class="bi bi-plus-circle me-2"></i>Добави сграда
 </a>
 </td>
 </tr>
 </tbody>
 </table>
 </div>
 </div>
 </div>
 </div>
</div>

<!-- Бързи действия -->
<div class="row">
 <div class="col-12">
 <div class="card">
 <div class="card-header">
 <h6 class="m-0 font-weight-bold text-primary">
 <i class="bi bi-lightning"></i> Бързи действия
 </h6>
 </div>
 <div class="card-body">
 <div class="row">
 <div class="col-md-3 mb-2">
 <a href="/buildings/add" class="btn btn-success w-100 btn-sm">
 <i class="bi bi-plus-circle me-2"></i>Добави сграда
 </a>
 </div>
 <div class="col-md-3 mb-2">
 <a href="/" class="btn btn-primary w-100 btn-sm">
 <i class="bi bi-building me-2"></i>Управлявай апартаменти
 </a>
 </div>
 <div class="col-md-3 mb-2">

 </div>
 <div class="col-md-3 mb-2">
 <a href="/payment-plans" class="btn btn-warning w-100 btn-sm">
 <i class="bi bi-calendar-check me-2"></i>Планове за плащане
 </a>
 </div>
 </div>
 </div>
 </div>
 </div>
</div>
 </div>

 <!-- Bootstrap JS -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <!-- jQuery -->
 <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
 <!-- DataTables JS -->
 <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
 <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
 
 <script>
 $(document).ready(function() {
 // Инициализация на DataTables
 if ($('#buildingsTable').length) {
 $('#buildingsTable').DataTable({
 language: {
 // Използваме вградени български настройки
 "sProcessing": "Обработване...",
 "sLengthMenu": "Покажи _MENU_ записа",
 "sZeroRecords": "Не са намерени съответстващи записи",
 "sInfo": "Показване на _START_ до _END_ от _TOTAL_ записа",
 "sInfoEmpty": "Показване на 0 до 0 от 0 записа",
 "sInfoFiltered": "(филтрирани от _MAX_ общо записа)",
 "sSearch": "Търсене:",
 "sEmptyTable": "Няма данни в таблицата",
 "sFirst": "Първа",
 "sPrevious": "Предишна",
 "sNext": "Следваща",
 "sLast": "Последна"
 },
 order: [[2, 'desc']], // Сортиране по дата на създаване (най-новите първо)
 pageLength: 10,
 scrollX: true,
 responsive: true
 });
 }
    });
    </script>
    </div>
    </div> <!-- End main-content -->
    
    <!-- Sidebar Script -->
    <th:block th:replace="~{fragments/sidebar :: sidebarScript}"></th:block>
</body>
</html>
